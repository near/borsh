jobs:
  include:
    - language: rust
      rust:
        - stable
        - beta
        - nightly-2019-05-22
        - nightly

      install:
        - cargo build --verbose --manifest-path=borsh-rs/Cargo.toml

      script:
        - cargo build --verbose --manifest-path=borsh-rs/Cargo.toml
        - cargo test --verbose --manifest-path=borsh-rs/Cargo.toml

      addons:
        apt:
          packages:
            - libcurl4-openssl-dev
            - libelf-dev
            - libdw-dev
            - cmake
            - gcc
            - binutils-dev
            - libiberty-dev

      after_success: |
        cd borsh-rs
        wget https://github.com/SimonKagstrom/kcov/archive/master.tar.gz &&
        tar xzf master.tar.gz &&
        cd kcov-master &&
        mkdir build &&
        cd build &&
        cmake .. &&
        make &&
        make install DESTDIR=../../kcov-build &&
        cd ../.. &&
        rm -rf kcov-master &&
        for file in target/debug/*; do [ -x "${file}" ] || continue; mkdir -p "target/cov/$(basename $file)"; ./kcov-build/usr/local/bin/kcov --exclude-pattern=/.cargo,/usr/lib --verify "target/cov/$(basename $file)" "$file"; done &&
        bash <(curl -s https://codecov.io/bash) &&
        echo "Uploaded code coverage"

    - language: node_js
      node_js:
        - 12
